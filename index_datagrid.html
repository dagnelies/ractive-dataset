<!doctype html>
<html lang='en'>
<head>
	<meta charset='utf-8'>
	<title>Datagrid plugin for Ractive.js</title>

	<!-- CSS -->
	<link href='http://fonts.googleapis.com/css?family=Voltaire' rel='stylesheet' type='text/css'>
	<link rel='stylesheet' href='style.css'>
	
	<!-- random data generator -->
	<script src='https://cdnjs.cloudflare.com/ajax/libs/chance/0.5.6/chance.min.js'></script>
	
	<!-- Ractive -->
	<script src='http://cdn.ractivejs.org/latest/ractive.js'></script>
	<script src='ractive-dataset.js'></script>
	<style>
		* {
			box-sizing: border-box;
		}
		
		table {
			width: 100%;
			table-layout: fixed;
		}
		
		table input {
			width: 100%;
		}
		
		.table-scroll {
			width: 100%;
			overflow: auto;
			max-height: 500px;
		}

		
	</style>
</head>

<body>

	<h1>Datagrid : inline editting, pageable, move up/down, remove</h1>
	
	<div id='demo' class='clearfix'></div>

	
	<h3>Disclaimer: some features do not work with others.</h3>
	
	<p>Inline editting and adding cannot be applied with lists that are at the same time filtered or sorted.
	The problem is obvious: while typing, your row may disappear or be moved away because of filtering/sorting.
	In order to edit/add rows in a filtered/sorted table, you have to make this "at once" through another form outside the grid.</p>
	
	<p>The same applies with filtering/sorting and moving elements in a list up and down. It's the first, or the latter, but combining both does not make sense.</p>
	
	<!-- Demo template -->
	<script id='demo-template' type='text/ractive'>
		<p><button on-click="addRandomData(100)">Add 100 entries</button><button on-click="addRandomData(10000)">Add 10,000 entries !!!</button></p>
		<p>Search: <input value="{{filter}}" /></p>
		<p>Sort by: <select value="{{sortby}}">
			<option></option>
			<option>first_name</option>
			<option>last_name</option>
			<option>email</option>
			<option>address</option>
		</select></p>
		<p>Rows per page: <input type="number" step="1" value="{{perpage}}" /></p>
		<p>Entries: {{users.length}}</p>
		
		<hr/>

		<table>
			<thead>
				<tr>
					<th>First Name</th>
					<th>Last Name</th>
					<th>EMail</th>
					<th>Address</th>
				</tr>
			</thead>
			<tbody>
				<dataset data="{{users}}" filter="{{filter}}" sortby="{{sortby}}" from="{{(page-1)*perpage}}" to="{{page*perpage}}" count="{{count}}">
					<tr>
						<td><input value="{{.first_name}}" /></td>
						<td><input value="{{.last_name}}" /></td>
						<td><input value="{{.email}}" /></td>
						<td><input value="{{.address}}" /></td>
					</tr>
				</dataset>
			</tbody>
		</table>
		<div style="float: right">
			{{#if count > perpage}}
				{{#if page > 1}}
					<a href="#1" on-click="set('page', 1)">&lt;&lt;</a>
					<a href="#{{page-1}}" on-click="set('page', page-1)">&lt;</a>
				{{/if}}
				Page: <input type="number" step="1" min="1" max="1000" value="{{page}}" style="width:50px;" /> of {{pagecount}}
				<div style="display:inline-block; width:80px;">
				{{#if page*perpage < count}}
					<a href="#{{page+1}}" on-click="set('page', page+1)">&gt;</a>
					<a href="#{{pagecount}}" on-click="set('page', pagecount)">&gt;&gt;</a>
				{{/if}}
				</div>
			{{/if}}
		</div>
	
		<button on-click="push('users', {})">Add user</button>
	</script>



	<!-- Demo code -->
	<script id='demo-code'>
	
		function compare(a,b) {
			if (a > b) {
				return 1;
			}
			if (a < b) {
				return -1;
			}
			return 0;
		}
		
		function findAny(obj, str) {
			for(var key in obj) {
				var value = obj[key]
				if( typeof value === 'string' && value.indexOf(str) >= 0 )
					return true;
			}
			return false;
		}
		
		ractive = new Ractive({
			el: 'demo',
			template: '#demo-template',
			addRandomData: function(num) {
				var added = []
				for(var i=0; i < num; i++) {
					added.push({
						first_name: chance.first(),
						last_name: chance.last(),
						email: chance.email(),
						address: chance.address()
					});
				}
				var users = this.get('users')
				users = users.concat(added)
				this.set('users', users)
			},
			data: {
				users: [],
				page: 1,
				filter: '',
				sortby: '',
				perpage: 20
			},
			computed: {
				dataset: function() {
					var data = this.get('users')
					var filter = this.get('filter')
					var sortby = this.get('sortby')
					var perpage = this.get('perpage')
					
					if( !filter && !sortby ) {
						// just get the indexes
						result = data.map( function(val,i) { return i; } )
					}
					else {
						// index it
						var result = data.map( function(val,i) { return {index:i, value:val}; } )
						// filter it
						if( filter )
							result = result.filter( function(entry) { return findAny(entry.value, filter); } )
						// sort it
						if( sortby )
							result = result.sort( function(a,b) { return compare(a.value[sortby], b.value[sortby]); } )
						// we need indexes only
						result = result.map( function(entry){ return entry.index; } );
					}
					var pages = []
					if( perpage <= 0 ) {
						// add everything
						pages.push( result )
					}
					else {
						// split it into pages
						var i=0;
						while(i*perpage < result.length) {
							pages.push( result.slice(i*perpage,(i+1)*perpage) )
							i += 1
						}
					}
					return pages
				}
			}
		});
		
		ractive.addRandomData(100);
	</script>

</body>
</html>
<!--
<datatable data="{{users}}">

<dataset data="{{users}}" sort="{{sortby}}" filter="{{filter}}" page="{{page}}" perpage="30" >
	<tr>
		<td><input value="{{.first_name}}" /></td>
		<td><input value="{{.last_name}}" /></td>
		<td><input value="{{.email}}" /></td>
		<td><input value="{{.address}}" /></td>
	</tr>
</dataset>

<datatable data="{{users}}" editable="true/false" sortable="true/false" selectable="single|multi|none" selected="{{}}" filterable="true/false" perpage="30" fields="a|b|c" headers="A|B|C" />

-->